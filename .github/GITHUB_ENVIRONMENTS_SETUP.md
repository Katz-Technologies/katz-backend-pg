# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Environments –¥–ª—è Manual Approval

GitHub Environments –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å manual approval –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤ production, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π.

---

## üéØ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã Environments?

1. **Manual Approval** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤ production
2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏** - —Ä–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è dev, stage, production
3. **Deployment protection** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
4. **Deployment history** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–ø–ª–æ–µ–≤

---

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Environment –¥–ª—è Production

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Environments**
3. –ù–∞–∂–º–∏—Ç–µ **New environment**
4. –í–≤–µ–¥–∏—Ç–µ –∏–º—è: `production`
5. –ù–∞–∂–º–∏—Ç–µ **Configure environment**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Protection Rules –¥–ª—è Production

‚úÖ –í–∫–ª—é—á–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ü–∏–∏:

#### Deployment branches
- [x] **Selected branches**: –≤—ã–±–µ—Ä–∏—Ç–µ `main`
  - –¢–æ–ª—å–∫–æ –≤–µ—Ç–∫–∞ `main` –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å—Å—è –≤ production

#### Deployment protection rules

- [x] **Required reviewers**: `1` –∏–ª–∏ –±–æ–ª–µ–µ
  - –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ–¥–æ–±—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –º–∏–Ω–∏–º—É–º 1 tech lead –∏–ª–∏ senior developer

- [x] **Wait timer**: `0` –º–∏–Ω—É—Ç (–∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  - –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–µ–ø–ª–æ–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [x] **Prevent self-review** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - –ó–∞–ø—Ä–µ—â–∞–µ—Ç –∞–≤—Ç–æ—Ä—É PR –æ–¥–æ–±—Ä—è—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π

#### Environment secrets

–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `SSH_HOST` - —Ö–æ—Å—Ç production —Å–µ—Ä–≤–µ—Ä–∞
- `SSH_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH
- `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
- `SSH_PORT` - –ø–æ—Ä—Ç SSH (–æ–±—ã—á–Ω–æ 22)
- `DEPLOY_PATH` - –ø—É—Ç—å –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `GIT_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è production

> **–í–∞–∂–Ω–æ**: –°–µ–∫—Ä–µ—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ Environment –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

---

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ Environment –¥–ª—è Staging

1. –ù–∞–∂–º–∏—Ç–µ **New environment**
2. –í–≤–µ–¥–∏—Ç–µ –∏–º—è: `staging`
3. –ù–∞–∂–º–∏—Ç–µ **Configure environment**

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Protection Rules –¥–ª—è Staging

‚úÖ –í–∫–ª—é—á–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ü–∏–∏:

#### Deployment branches
- [x] **Selected branches**: –≤—ã–±–µ—Ä–∏—Ç–µ `stage`
  - –¢–æ–ª—å–∫–æ –≤–µ—Ç–∫–∞ `stage` –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å—Å—è –≤ staging

#### Deployment protection rules

- [ ] **Required reviewers**: –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å 1 reviewer
  - –î–ª—è staging –æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è manual approval

#### Environment secrets

–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è staging –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ production, –Ω–æ –¥–ª—è DEV —Å–µ—Ä–≤–µ—Ä–∞):

- `SSH_HOST` - —Ö–æ—Å—Ç staging/DEV —Å–µ—Ä–≤–µ—Ä–∞
- `SSH_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH
- `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
- `SSH_PORT` - –ø–æ—Ä—Ç SSH
- `DEPLOY_PATH` - –ø—É—Ç—å –¥–ª—è –¥–µ–ø–ª–æ—è
- `GIT_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- –î—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è staging

---

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ Environment –¥–ª—è Development (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ development –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

1. –ù–∞–∂–º–∏—Ç–µ **New environment**
2. –í–≤–µ–¥–∏—Ç–µ –∏–º—è: `development`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ staging, –Ω–æ –±–µ–∑ required reviewers

---

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Environments –≤ Workflows

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Environments, –æ–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à–∏ workflows –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è environments:

```yaml
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: production  # –ò–º—è environment
      url: https://your-production-url.com  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: URL –¥–ª—è deployment
    steps:
      # ... –≤–∞—à–∏ —à–∞–≥–∏ –¥–µ–ø–ª–æ—è
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è production workflow:

```yaml
name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    environment:
      name: production
      url: https://api.yourdomain.com  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    steps:
      - name: Deploy
        # ... —à–∞–≥–∏ –¥–µ–ø–ª–æ—è
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –°–æ–∑–¥–∞–π—Ç–µ PR –∏–∑ `stage` –≤ `main`
2. –ü–æ—Å–ª–µ merge –≤ `main`, workflow –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
3. –í workflow –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —à–∞–≥ **"Waiting for approval"**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π workflow
5. –ù–∞–∂–º–∏—Ç–µ **Review deployments** ‚Üí **Approve and deploy**

---

## üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

### –°–µ–∫—Ä–µ—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ Environment

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Environments**
2. –í—ã–±–µ—Ä–∏—Ç–µ environment (–Ω–∞–ø—Ä–∏–º–µ—Ä, `production`)
3. –í —Ä–∞–∑–¥–µ–ª–µ **Environment secrets** –Ω–∞–∂–º–∏—Ç–µ **Add secret**
4. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
5. –ù–∞–∂–º–∏—Ç–µ **Add secret**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤

1. **Environment secrets** (–Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. **Repository secrets**
3. **Organization secrets** (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

---

## üìù Best Practices

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
2. ‚úÖ –ú–∏–Ω–∏–º—É–º 1 required reviewer –¥–ª—è production
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ wait timer –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–µ–ø–ª–æ–µ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
5. ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ production environment —Ç–æ–ª—å–∫–æ senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
6. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL –≤ environment –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è deployments

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Environment –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ environment —Å–æ–∑–¥–∞–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–º—è environment –≤ workflow —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –º–æ–≥—É –æ–¥–æ–±—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π"

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ required reviewers
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ –≤–∫–ª—é—á–µ–Ω "Prevent self-review" (–µ—Å–ª–∏ –≤—ã –∞–≤—Ç–æ—Ä PR)

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–µ–∫—Ä–µ—Ç—ã –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã"

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π environment
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ workflow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π environment
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ (environment > repository)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [GitHub Environments Documentation](https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment)
- [GitHub Environments Best Practices](https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#deployment-protection-rules)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2024

