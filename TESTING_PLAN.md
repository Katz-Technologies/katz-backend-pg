# –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è CI/CD

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (15 —Ñ–∞–π–ª–æ–≤):**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: bithomp, coingecko, gecko-terminal, sologenic, xrpl-meta, xrp-scan
- ‚úÖ SmartMoneyService
- ‚úÖ NewTokenService
- ‚úÖ HealthController
- ‚úÖ Exception handling (BackendException, GlobalExceptionFilter)
- ‚úÖ Domain layer (4/6):
  - ‚úÖ chain.domain.ts (8 —Ç–µ—Å—Ç–æ–≤)
  - ‚úÖ tags.domain.ts (30+ —Ç–µ—Å—Ç–æ–≤)
  - ‚úÖ balances-volumes.domain.ts (12+ —Ç–µ—Å—Ç–æ–≤)
  - ‚úÖ process-money-flow-rows.domain.ts (15+ —Ç–µ—Å—Ç–æ–≤)
  - ‚ùå sales.domain.ts
  - ‚ùå chart.domain.ts

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** ~183 —Ç–µ—Å—Ç–∞ (70 –≤ domain layer)

**–¶–µ–ª—å –¥–ª—è CI/CD:** –ü–æ–∫—Ä—ã—Ç–∏–µ ‚â•70%

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–û (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) - –ë–ª–æ–∫–µ—Ä—ã –¥–ª—è CI/CD

### 1. Domain Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:** –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –æ—à–∏–±–∫–∏ –∑–¥–µ—Å—å –∫—Ä–∏—Ç–∏—á–Ω—ã.

#### 1.1 `src/domain/sales/sales.domain.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û ‚úÖ –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `addPurchase()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
  - `addSale()` - —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–¥–∞–∂–∏ –∏ PnL
  - `manageNonXrpSwap()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–æ–ø–æ–≤
  - `getSalesByAsset()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –ø–æ –∞–∫—Ç–∏–≤—É
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - —Ä–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - FIFO –ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫/–ø—Ä–æ–¥–∞–∂ ‚úÖ
  - –†–∞—Å—á–µ—Ç PnL –∏ ROI ‚úÖ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ ‚úÖ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–æ–ø–æ–≤ –º–µ–∂–¥—É –Ω–µ-XRP —Ç–æ–∫–µ–Ω–∞–º–∏ ‚úÖ
- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:** `sales.domain.spec.ts` (19 —Ç–µ—Å—Ç–æ–≤)

#### 1.2 `src/domain/chain/chain.domain.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û ‚úÖ –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `createChainStep()` - —Å–æ–∑–¥–∞–Ω–∏–µ —à–∞–≥–∞ —Ü–µ–ø–æ—á–∫–∏ ‚úÖ
  - `buildChainTree()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ü–µ–ø–æ—á–∫–∏ —Å –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏ ‚úÖ
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö –ø—Ä–æ–¥–∞–∂
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –≤ —Ü–µ–ø–æ—á–∫–µ ‚úÖ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö —Ü–µ–ø–æ—á–µ–∫ ‚úÖ
- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:** `chain.domain.spec.ts` (8 —Ç–µ—Å—Ç–æ–≤)

#### 1.3 `src/domain/tags/tags.domain.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û ‚úÖ –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getTags()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ ‚úÖ
  - –í—Å–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã `manage*()` ‚úÖ
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Whale, Bot, ActiveTrader –∏ —Ç.–¥. ‚úÖ
  - –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–≥–∞ ‚úÖ
  - –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ç–µ–≥–æ–≤ ‚úÖ
- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:** `tags.domain.spec.ts` (30+ —Ç–µ—Å—Ç–æ–≤)

#### 1.4 `src/domain/chart/chart.domain.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û ‚ùå –ù–ï –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `buildTokenCharts()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –æ–±—ä–µ–º–æ–≤
  - `buildTokenHoldersChartsFromBalances()` - –≥—Ä–∞—Ñ–∏–∫–∏ —Ö–æ–ª–¥–µ—Ä–æ–≤
  - `hasPositiveBalanceInRangeOptimized()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (hour, day, week, month)
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

#### 1.5 `src/domain/balances-volumes/balances-volumes.domain.ts` ‚úÖ –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getBalancesAndVolumes()` - —Ä–∞—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤ –∏ –æ–±—ä–µ–º–æ–≤ ‚úÖ
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è
- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:** `balances-volumes.domain.spec.ts` (12+ —Ç–µ—Å—Ç–æ–≤)

#### 1.6 `src/domain/process-money-flow-rows/process-money-flow-rows.domain.ts` ‚úÖ –ü–û–ö–†–´–¢–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `processMoneyFlowRows()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ ‚úÖ
  - `parseCloseTime()` - –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ ‚úÖ
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è
- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:** `process-money-flow-rows.domain.spec.ts` (15+ —Ç–µ—Å—Ç–æ–≤)

### 2. Services Layer (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã)

#### 2.1 `src/common/clickhouse/clickhouse.service.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:** –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö, –æ—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getMoneyFlows()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
  - `getTokenSummary()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ —Ç–æ–∫–µ–Ω—É
  - `getAllTokens()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
  - `processSummary()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–æ–¥–∫–∏
  - `parseCloseTime()` - –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ ClickHouse –∫–ª–∏–µ–Ω—Ç–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç

#### 2.2 `src/services/icons/icons-cache.service.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö —Ç–æ–∫–µ–Ω–æ–≤
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getTokenIconWithFallback()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —Å fallback
  - `saveTopTokens()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ø —Ç–æ–∫–µ–Ω–æ–≤
  - `getTopTokensForTrending()` - –ø–æ–ª—É—á–µ–Ω–∏–µ trending —Ç–æ–∫–µ–Ω–æ–≤
  - `getAccountIcon()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–æ–∫
  - Fallback –ª–æ–≥–∏–∫–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏

#### 2.3 `src/services/icons/icons.service.ts`
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getTokenIcon()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —Ç–æ–∫–µ–Ω–∞
  - `getAccountIcon()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
  - `isValidIconUrl()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è URL
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è

#### 2.4 `src/services/icons/hashicon-detector.service.ts`
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `isHashicon()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ hashicon
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

#### 2.5 `src/services/tokens/tokens.service.ts`
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getTopTokensList()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–ø —Ç–æ–∫–µ–Ω–æ–≤
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

### 3. Controllers (API endpoints)

#### 3.1 `src/controller/v1/smart-money/smart-money.controller.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:** –û—Å–Ω–æ–≤–Ω–æ–π API –¥–ª—è smart money —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **Endpoints –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `GET /v1/smart-money/sales` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂
  - `GET /v1/smart-money/money-flows` - –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
  - `GET /v1/smart-money/token-summary/:asset` - —Å–≤–æ–¥–∫–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
  - `GET /v1/smart-money/chart/:token` - –≥—Ä–∞—Ñ–∏–∫–∏
  - `GET /v1/smart-money/top-pnl-accounts` - —Ç–æ–ø –∞–∫–∫–∞—É–Ω—Ç—ã
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤

#### 3.2 `src/controller/v1/top-tokens/top-tokens.controller.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **Endpoints –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `POST /v1/top-tokens/token` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  - `GET /v1/top-tokens/trending` - trending —Ç–æ–∫–µ–Ω—ã
  - `POST /v1/top-tokens/icons/accounts` - –∏–∫–æ–Ω–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  - `POST /v1/top-tokens/icons/tokens` - –∏–∫–æ–Ω–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
  - `GET /v1/top-tokens` - –≤—Å–µ —Ç–æ–ø —Ç–æ–∫–µ–Ω—ã
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - –æ—Å–Ω–æ–≤–Ω–æ–π API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

#### 3.3 –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
- `src/controller/v1/bithomp/bithomp.controller.ts`
- `src/controller/v1/coingecko/coingecko.controller.ts`
- `src/controller/v1/gecko-terminal/gecko-terminal.controller.ts`
- `src/controller/v1/sologenic/sologenic.controller.ts`
- `src/controller/v1/xrp-scan/xrp-scan.controller.ts`
- `src/controller/v1/xrpl-meta/xrpl-meta.controller.ts`

### 4. Common Services (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

#### 4.1 `src/common/redis/internal-redis.adapter.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `getAsJson()`, `setAsJson()`, `setAsJsonEx()`
  - `pipelineWithJson()` - –ø–∞–π–ø–ª–∞–π–Ω—ã
  - `waitUntilReady()` - –æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ

#### 4.2 `src/common/redis/external-redis.adapter.ts` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ internal-redis.adapter.ts**

#### 4.3 `src/jobs/cron.service.ts`
- **–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
  - `handleTopTokensCron()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ø —Ç–æ–∫–µ–Ω–æ–≤
  - `handleTokenIconsCron()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∫–æ–Ω–æ–∫
  - `handleAccountIconsCron()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∫–æ–Ω–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

---

## üü° –í–ê–ñ–ù–û (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) - –ü–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö

### 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 5.1 `src/services/icons/icon-optimizer.service.ts`
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64

#### 5.2 `src/common/logger/logging.interceptor.ts`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- –£—Å–µ—á–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### 5.3 `src/common/deque/deque.class.ts`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Deque
- –û–ø–µ—Ä–∞—Ü–∏–∏ push/pop

---

## üü¢ –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)

### 6. E2E —Ç–µ—Å—Ç—ã
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ user flows
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –° —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (Redis, ClickHouse)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ testcontainers

---

## üìã –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è CI/CD

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚ö†Ô∏è Domain layer (5/6 –ø–æ–∫—Ä—ã—Ç–æ):
   - ‚úÖ chain.domain.ts
   - ‚úÖ tags.domain.ts
   - ‚úÖ balances-volumes.domain.ts
   - ‚úÖ process-money-flow-rows.domain.ts
   - ‚úÖ sales.domain.ts (–ö–†–ò–¢–ò–ß–ù–û - FIFO –ª–æ–≥–∏–∫–∞) ‚úÖ
   - ‚ùå chart.domain.ts (–ö–†–ò–¢–ò–ß–ù–û - –≥—Ä–∞—Ñ–∏–∫–∏)
2. ‚ùå ClickhouseService
3. ‚ùå IconsCacheService
4. ‚ùå SmartMoneyController
5. ‚ùå TopTokensController
6. ‚ùå Redis –∞–¥–∞–ø—Ç–µ—Ä—ã

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (1 –Ω–µ–¥–µ–ª—è)
7. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
8. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
9. Cron jobs

### –§–∞–∑–∞ 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
10. E2E —Ç–µ—Å—Ç—ã
11. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** ‚â•70%
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** 100% –ø–æ–∫—Ä—ã—Ç–∏–µ
- **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:** ‚úÖ
- **CI/CD pipeline:** –ó–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º

1. **–ú–æ–∫–∏:**
   - `@nestjs/testing` –¥–ª—è NestJS –º–æ–¥—É–ª–µ–π
   - `jest.mock()` –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - `nock` –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

2. **Testcontainers:**
   - `@testcontainers/redis` –¥–ª—è Redis
   - `@testcontainers/clickhouse` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

3. **Coverage:**
   - `jest --coverage` –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å thresholds –≤ `jest.config.js`

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### üî¥ –°–†–û–ß–ù–û (–ë–ª–æ–∫–µ—Ä—ã –¥–ª—è CI/CD):

1. **`sales.domain.ts`** - –ö–†–ò–¢–ò–ß–ù–û! FIFO –ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫/–ø—Ä–æ–¥–∞–∂, —Ä–∞—Å—á–µ—Ç PnL ‚úÖ
2. **`chart.domain.ts`** - –ö–†–ò–¢–ò–ß–ù–û! –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. **`clickhouse.service.ts`** - –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
4. **`icons-cache.service.ts`** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
5. **`smart-money.controller.ts`** - –û—Å–Ω–æ–≤–Ω–æ–π API
6. **`top-tokens.controller.ts`** - API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
7. **Redis –∞–¥–∞–ø—Ç–µ—Ä—ã** - –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### üü° –í–ê–ñ–ù–û (–ü–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö):

8. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
9. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (icons, tokens, hashicon-detector)
10. Cron jobs

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: 1-2 –Ω–µ–¥–µ–ª–∏
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ 70%: 2-3 –Ω–µ–¥–µ–ª–∏

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∫—Ä—ã—Ç–∏—è

**Domain Layer:** 5/6 (83%) ‚úÖ
- ‚úÖ chain.domain.ts
- ‚úÖ tags.domain.ts  
- ‚úÖ balances-volumes.domain.ts
- ‚úÖ process-money-flow-rows.domain.ts
- ‚úÖ sales.domain.ts
- ‚ùå chart.domain.ts

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** ~15% –ø–æ–∫—Ä—ã—Ç–∏—è (–æ—Ü–µ–Ω–∫–∞)

